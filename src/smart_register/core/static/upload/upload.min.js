if(typeof Object.assign!=="function"){Object.assign=function(target,varArgs){"use strict";if(target==null){throw new TypeError("Cannot convert undefined or null to object")}var to=Object(target);for(var index=1;index<arguments.length;index++){var nextSource=arguments[index];if(nextSource!=null){for(var nextKey in nextSource){if(Object.prototype.hasOwnProperty.call(nextSource,nextKey)){to[nextKey]=nextSource[nextKey]}}}}return to}}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function(searchElement,fromIndex){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(len===0){return false}var n=fromIndex|0;var k=Math.max(n>=0?n:len-Math.abs(n),0);while(k<len){if(o[k]===searchElement){return true}k++}return false}})}(function($){$(function(){var M=1048576;function returnFileSize(number){if(number<1024){return number+"bytes"}else if(number>=1024&&number<1048576){return(number/1024).toFixed(1)+"KB"}else if(number>=1048576){return(number/1048576).toFixed(1)+"MB"}}function resizeBase64Img(base64,width,height){var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");var deferred=$.Deferred();$("<img/>").attr("src","data:image/gif;base64,"+base64).load(function(){context.scale(width/this.width,height/this.height);context.drawImage(this,0,0);deferred.resolve($("<img/>").attr("src",canvas.toDataURL()))});return deferred.promise()}var UploadHandler=function($field){var $error=$field.parents(".field-container").find(".size-error");var sizeLimit=$field.data("max-size")||M*10;var sizeLimitFormat=gettext("File too big. Max %s ");var sizeMax=returnFileSize(sizeLimit);var sizeLimitMessage=interpolate(sizeLimitFormat,[sizeMax]);$field.on("change",function(e){var file=e.target.files[0];$error.html("");if(file!==undefined){if(file.size>sizeLimit){$field.attr("type","text");$field.attr("type","file");$error.html('<ul class="errorlist"><li>'+sizeLimitMessage+"</li></ul>")}}})};var UploadManager=function(){var self=this;var fields=[];self.addField=function(f){var $field=$(f);var name=$field.attr("id");if(!fields.includes(name)){$field.data("handler",new UploadHandler($field));fields.push(name)}}};window.uploadManager=new UploadManager;$("input.vUploadField").each(function(){window.uploadManager.addField(this)})})})(jQuery);