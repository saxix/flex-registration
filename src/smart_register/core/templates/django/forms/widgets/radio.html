{% with id=widget.attrs.id %}
    <ul{% if id %} id="{{ id }}"{% endif %}{% if widget.attrs.class %} class="{{ widget.attrs.class }}"{% endif %}>
        {% for group, options, index in widget.optgroups %}{% if group %}
            <li>{% if user.is_staff %}{% include "i18n/_staff_edit_i18n.html" with original=group %}{% endif %}{{ group }}
            <ul{% if id %} id="{{ id }}_{{ index }}"{% endif %}>{% endif %}{% for option in options %}
            <li>{% include option.template_name with widget=option user=request.user %}</li>{% endfor %}{% if group %}
            </ul></li>{% endif %}{% endfor %}
    </ul>{% endwith %}
