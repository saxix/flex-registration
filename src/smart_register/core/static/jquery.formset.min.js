!function(h){h.fn.formset=function(e){function i(e,s){m.extraClasses&&(e.removeClass(r),e.addClass(m.extraClasses[s%m.extraClasses.length]))}function o(e,s,a){var t=new RegExp(s+"-(\\d+|__prefix__)-"),a=s+"-"+a+"-";e.attr("for")&&e.attr("for",e.attr("for").replace(t,a)),e.attr("id")&&e.attr("id",e.attr("id").replace(t,a)),e.attr("name")&&e.attr("name",e.attr("name").replace(t,a))}function f(){return""===d.val()||0<d.val()-p.val()}function C(){return""===l.val()||0<p.val()-l.val()}function s(e){var l=h.trim(m.deleteCssClass).replace(/\s+/g,"."),n=h.trim(m.addCssClass).replace(/\s+/g,"."),s='<a class="'+m.deleteCssClass+'" href="javascript:void(0)">'+m.deleteText+"</a>";m.deleteContainerClass?e.find("."+m.deleteContainerClass).append(s):e.is("TR")?e.children(":last").append(s):e.is("UL")||e.is("OL")?e.append("<li>"+s+"</li>"):e.append(s),C()||e.find("a."+l).hide(),e.find("a."+l).click(function(){var e=h(this).parents("."+m.formCssClass),s=e.find('input:hidden[id $= "-DELETE"]'),a=e.siblings("a."+n+", ."+m.formCssClass+"-add"),t=s.length?(s.val("on"),e.hide(),h("."+m.formCssClass).not(":hidden")):(e.remove(),h("."+m.formCssClass).not(".formset-custom-template"));p.val(t.length);for(var r=0,d=t.length;r<d;r++)i(t.eq(r),r),s.length||t.eq(r).find(c).each(function(){o(h(this),m.prefix,r)});return C()||h("a."+l).each(function(){h(this).hide()}),a.is(":hidden")&&f()&&a.show(),m.removed&&m.removed(e),!1})}var a,t,m=h.extend({},h.fn.formset.defaults,e),r=m.extraClasses.join(" "),p=h("#id_"+m.prefix+"-TOTAL_FORMS"),d=h("#id_"+m.prefix+"-MAX_NUM_FORMS"),l=h("#id_"+m.prefix+"-MIN_NUM_FORMS"),c="input,select,textarea,label,div",n=h(this);return n.length&&(e=!f(),m.formTemplate?((t=m.formTemplate instanceof h?m.formTemplate:h(m.formTemplate)).removeAttr("id").addClass(m.formCssClass+" formset-custom-template"),t.find(c).each(function(){o(h(this),m.prefix,"__prefix__")})):(m.hideLastAddForm&&h("."+m.formCssClass+":last").hide(),(t=h("."+m.formCssClass+":last").clone(!0).removeAttr("id")).find('input:hidden[id $= "-DELETE"]').remove(),t.find(c).not(m.keepFieldValues).each(function(){var e=h(this);e.is("input:checkbox")||e.is("input:radio")?e.attr("checked",!1):e.val("")})),s(t),m.formTemplate=t,t='<a class="'+m.addCssClass+'" href="javascript:void(0)">'+m.addText+"</a>",t=m.addContainerClass?((a=h("."+m.addContainerClass)).append(t),a.find('[class="'+m.addCssClass+'"]')):n.is("TR")?(a=n.eq(0).children().length,a=h('<tr><td colspan="'+a+'">'+t+"</tr>").addClass(m.formCssClass+"-add"),n.parent().append(a),a.find("a")):(n.filter(":last").after(t),n.filter(":last").next()),e&&t.hide(),t.click(function(){var e=parseInt(p.val()),s=m.formTemplate.clone(!0).removeClass("formset-custom-template"),a=h(h(this).parents("tr."+m.formCssClass+"-add").get(0)||this),t=h.trim(m.deleteCssClass).replace(/\s+/g,".");return i(s,e),s.insertBefore(a).show(),s.find(c).each(function(){o(h(this),m.prefix,e)}),p.val(e+1),C()&&h("a."+t).each(function(){h(this).show()}),f()||a.hide(),m.added&&m.added(s),!1})),n},h.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addContainerClass:null,deleteContainerClass:null,addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null,hideLastAddForm:!1}}(jQuery);
