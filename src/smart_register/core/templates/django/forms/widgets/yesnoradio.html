{% with id=widget.attrs.id %}<div{% if id %} id="{{ id }}"{% endif %}{% if widget.attrs.class %} class="{{ widget.attrs.class }}"{% endif %}>{% for group, options, index in widget.optgroups %}{% if group %}
    <span>{{ group }}<span{% if id %} id="{{ id }}_{{ index }}"{% endif %}>{% endif %}{% for option in options %}
    <span>
        {% include option.template_name with widget=option user=user %}</span>{% endfor %}{% if group %}
    </span></span>{% endif %}{% endfor %}
</div>{% endwith %}
